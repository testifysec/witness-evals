{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I create a basic witness policy document?"}, {"role": "assistant", "content": "Here's a complete witness policy structure:\n\n```json\n{\n  \"expires\": \"2025-12-31T23:59:59Z\",\n  \"roots\": {\n    \"root-key-id\": {\n      \"certificate\": \"-----BEGIN CERTIFICATE-----\\n...\\n-----END CERTIFICATE-----\",\n      \"intermediates\": []\n    }\n  },\n  \"publickeys\": {\n    \"build-key-id\": {\n      \"keyid\": \"sha256:abc123...\",\n      \"key\": \"-----BEGIN PUBLIC KEY-----\\n...\\n-----END PUBLIC KEY-----\"\n    }\n  },\n  \"steps\": {\n    \"build\": {\n      \"name\": \"build\",\n      \"attestations\": [\n        {\"type\": \"https://witness.dev/attestations/git/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/environment/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/command-run/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/product/v0.1\"}\n      ],\n      \"functionaries\": [\n        {\n          \"type\": \"publickey\",\n          \"publickeyid\": \"build-key-id\"\n        }\n      ]\n    }\n  }\n}\n```\n\nSave this as `policy.json` and sign it:\n\n```bash\nwitness sign --infile policy.json --outfile policy-signed.json --key policy-key.pem\n```"}]}
{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I create a policy for a multi-step CI/CD pipeline?"}, {"role": "assistant", "content": "Here's a complete build\u2192test\u2192package policy:\n\n```json\n{\n  \"expires\": \"2025-12-31T23:59:59Z\",\n  \"publickeys\": {\n    \"ci-key\": {\n      \"keyid\": \"sha256:abc123...\",\n      \"key\": \"-----BEGIN PUBLIC KEY-----\\n...\\n-----END PUBLIC KEY-----\"\n    }\n  },\n  \"steps\": {\n    \"build\": {\n      \"name\": \"build\",\n      \"attestations\": [\n        {\"type\": \"https://witness.dev/attestations/git/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/command-run/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/product/v0.1\"}\n      ],\n      \"functionaries\": [{\"type\": \"publickey\", \"publickeyid\": \"ci-key\"}]\n    },\n    \"test\": {\n      \"name\": \"test\",\n      \"attestations\": [\n        {\"type\": \"https://witness.dev/attestations/material/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/command-run/v0.1\"}\n      ],\n      \"functionaries\": [{\"type\": \"publickey\", \"publickeyid\": \"ci-key\"}]\n    },\n    \"package\": {\n      \"name\": \"package\",\n      \"attestations\": [\n        {\"type\": \"https://witness.dev/attestations/material/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/oci/v0.1\"},\n        {\"type\": \"https://witness.dev/attestations/product/v0.1\"}\n      ],\n      \"functionaries\": [{\"type\": \"publickey\", \"publickeyid\": \"ci-key\"}]\n    }\n  }\n}\n```\n\nEach step creates attestations:\n\n```bash\n# Build step\nwitness run --step build \\\n  --attestations git,commandrun,product \\\n  -o build.json --key ci-key.pem \\\n  -- go build -o myapp\n\n# Test step\nwitness run --step test \\\n  --attestations material,commandrun \\\n  -o test.json --key ci-key.pem \\\n  -- go test ./...\n\n# Package step\nwitness run --step package \\\n  --attestations material,oci,product \\\n  -o package.json --key ci-key.pem \\\n  -- docker build -t myapp:latest .\n```\n\nVerify the complete pipeline:\n\n```bash\nwitness verify \\\n  --policy policy-signed.json \\\n  --publickey policy-key.pub \\\n  -a build.json -a test.json -a package.json \\\n  -f myapp\n```"}]}
{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I add Rego validation rules to my policy?"}, {"role": "assistant", "content": "Add a `rego` field to each attestation in your policy:\n\n```json\n{\n  \"steps\": {\n    \"build\": {\n      \"name\": \"build\",\n      \"attestations\": [\n        {\n          \"type\": \"https://witness.dev/attestations/git/v0.1\",\n          \"rego\": \"package git\\nimport rego.v1\\n\\ndeny contains msg if {\\n  input.branch != \\\"main\\\"\\n  msg := \\\"Must build from main branch\\\"\\n}\"\n        },\n        {\n          \"type\": \"https://witness.dev/attestations/command-run/v0.1\",\n          \"rego\": \"package commandrun\\nimport rego.v1\\n\\ndeny contains msg if {\\n  input.exitcode != 0\\n  msg := \\\"Build failed\\\"\\n}\"\n        }\n      ]\n    }\n  }\n}\n```\n\nOr reference external Rego files:\n\n```json\n{\n  \"steps\": {\n    \"build\": {\n      \"attestations\": [\n        {\n          \"type\": \"https://witness.dev/attestations/git/v0.1\",\n          \"regofile\": \"policies/git.rego\"\n        }\n      ]\n    }\n  }\n}\n```\n\nThe Rego policies are evaluated during `witness verify`."}]}
