{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I capture environment information in an attestation?"}, {"role": "assistant", "content": "The environment attestor captures system and environment variables:\n\n```bash\nwitness run --step build \\\n  --attestations environment,commandrun \\\n  --outfile build-attestation.json \\\n  --key key.pem \\\n  -- go build -o myapp\n```\n\nCaptured information:\n- Operating system (os)\n- Hostname\n- Username\n- Environment variables\n\nRego policy to validate build environment:\n\n```rego\npackage environment\n\nimport rego.v1\n\n# Ensure builds happen on Linux\ndeny contains msg if {\n    input.os != \"linux\"\n    msg := sprintf(\"Builds must run on Linux, got: %s\", [input.os])\n}\n\n# Validate specific environment variables are set\ndeny contains msg if {\n    not \"CI\" in input.variables\n    msg := \"Must run in CI environment (CI variable not set)\"\n}\n```"}]}
{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I enforce required environment variables in my build?"}, {"role": "assistant", "content": "Use Rego to validate the `variables` map:\n\n```rego\npackage environment\n\nimport rego.v1\n\n# Required environment variables\nrequired_vars := [\"CI\", \"BUILD_ID\", \"COMMIT_SHA\"]\n\ndeny contains msg if {\n    some var in required_vars\n    not var in input.variables\n    msg := sprintf(\"Required environment variable missing: %s\", [var])\n}\n\n# Deny dangerous variables\ndeny contains msg if {\n    \"DISABLE_TESTS\" in input.variables\n    input.variables[\"DISABLE_TESTS\"] == \"true\"\n    msg := \"Cannot disable tests in production builds\"\n}\n\n# Validate CI provider\ndeny contains msg if {\n    not \"GITHUB_ACTIONS\" in input.variables\n    not \"GITLAB_CI\" in input.variables\n    msg := \"Must run in GitHub Actions or GitLab CI\"\n}\n```"}]}
{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "Can I restrict which machines can perform builds?"}, {"role": "assistant", "content": "Yes, validate the hostname field:\n\n```rego\npackage environment\n\nimport rego.v1\n\n# Approved build servers\napproved_hosts := {\n    \"build-server-01.example.com\",\n    \"build-server-02.example.com\",\n    \"github-runner-*\"  # Wildcard pattern\n}\n\ndeny contains msg if {\n    not hostname_approved(input.hostname)\n    msg := sprintf(\"Unauthorized build host: %s\", [input.hostname])\n}\n\nhostname_approved(hostname) if {\n    some approved in approved_hosts\n    hostname == approved\n}\n\nhostname_approved(hostname) if {\n    some approved in approved_hosts\n    contains(approved, \"*\")\n    prefix := trim_suffix(approved, \"*\")\n    startswith(hostname, prefix)\n}\n```"}]}
