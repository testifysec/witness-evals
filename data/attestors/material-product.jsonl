{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I attest input files (materials) for a build?"}, {"role": "assistant", "content": "Use the material attestor to record all input files:\n\n```bash\nwitness run --step build \\\n  --attestations material,commandrun,product \\\n  --outfile build-attestation.json \\\n  --key key.pem \\\n  -- go build -o myapp\n```\n\nMaterials capture all files in the working directory before the command runs.\n\nRego policy to validate specific files exist:\n\n```rego\npackage material\n\nimport rego.v1\n\n# Required source files\nrequired_files := [\"main.go\", \"go.mod\", \"go.sum\"]\n\ndeny contains msg if {\n    some file in required_files\n    not file in input\n    msg := sprintf(\"Required source file missing: %s\", [file])\n}\n\n# Deny if sensitive files are present\ndeny contains msg if {\n    \".env\" in input\n    msg := \"Material must not include .env files (secrets)\"\n}\n```"}]}
{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I attest output files (products) from a build?"}, {"role": "assistant", "content": "Use the product attestor to record all output files:\n\n```bash\nwitness run --step build \\\n  --attestations commandrun,product \\\n  --outfile build-attestation.json \\\n  --key key.pem \\\n  -- go build -o myapp\n```\n\nProducts capture all files created or modified by the command.\n\nRego policy to validate expected outputs:\n\n```rego\npackage product\n\nimport rego.v1\n\n# Expected output binary\ndeny contains msg if {\n    not \"myapp\" in input\n    msg := \"Build must produce 'myapp' binary\"\n}\n\n# Validate file hash\nexpected_hashes := {\n    \"myapp\": \"sha256:abc123...\"\n}\n\ndeny contains msg if {\n    some file, digests in input\n    file in expected_hashes\n    not expected_hashes[file] in digests\n    msg := sprintf(\"File %s has unexpected hash\", [file])\n}\n```"}]}
{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I verify that files aren't tampered with between build and test steps?"}, {"role": "assistant", "content": "Use the new cross-step attestation access feature in policies:\n\n```json\n{\n  \"steps\": {\n    \"build\": {\n      \"name\": \"build\",\n      \"attestations\": [\n        {\"type\": \"https://witness.dev/attestations/product/v0.1\"}\n      ]\n    },\n    \"test\": {\n      \"name\": \"test\",\n      \"attestations\": [\n        {\"type\": \"https://witness.dev/attestations/material/v0.1\"}\n      ]\n    }\n  }\n}\n```\n\nRego policy with cross-step validation:\n\n```rego\npackage test\n\nimport rego.v1\n\n# Access build step's products\nbuild_products := input.attestations[\"build\"][\"https://witness.dev/attestations/product/v0.1\"]\n\n# Access test step's materials\ntest_materials := input.attestations[\"test\"][\"https://witness.dev/attestations/material/v0.1\"]\n\n# Ensure test uses the exact binary from build\ndeny contains msg if {\n    some file, build_hash in build_products\n    file == \"myapp\"\n    not file in test_materials\n    msg := sprintf(\"Test step missing file from build: %s\", [file])\n}\n\ndeny contains msg if {\n    some file in [\"myapp\"]\n    build_hash := build_products[file]\n    test_hash := test_materials[file]\n    build_hash != test_hash\n    msg := sprintf(\"File %s was modified between build and test\", [file])\n}\n```"}]}
