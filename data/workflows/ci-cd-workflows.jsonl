{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I integrate Witness into a GitHub Actions workflow?"}, {"role": "assistant", "content": "Here's a complete GitHub Actions workflow with Witness:\n\n```yaml\nname: Build with Witness\n\non:\n  push:\n    branches: [main]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install Witness\n        run: |\n          curl -LO https://github.com/in-toto/go-witness/releases/latest/download/witness-linux-amd64\n          chmod +x witness-linux-amd64\n          sudo mv witness-linux-amd64 /usr/local/bin/witness\n\n      - name: Load signing key\n        run: echo \"${{ secrets.WITNESS_KEY }}\" > key.pem\n\n      - name: Build with attestation\n        run: |\n          witness run --step build \\\n            --attestations git,github,environment,commandrun,product \\\n            -o build-attestation.json \\\n            --key key.pem \\\n            -- go build -o myapp\n\n      - name: Test with attestation\n        run: |\n          witness run --step test \\\n            --attestations material,commandrun \\\n            -o test-attestation.json \\\n            --key key.pem \\\n            -- go test ./...\n\n      - name: Upload attestations\n        uses: actions/upload-artifact@v4\n        with:\n          name: attestations\n          path: |\n            build-attestation.json\n            test-attestation.json\n\n  verify:\n    needs: build\n    runs-on: ubuntu-latest\n    steps:\n      - name: Download attestations\n        uses: actions/download-artifact@v4\n        with:\n          name: attestations\n\n      - name: Verify attestations\n        run: |\n          witness verify \\\n            --policy policy-signed.json \\\n            --publickey policy-key.pub \\\n            -a build-attestation.json \\\n            -a test-attestation.json \\\n            -f myapp\n```"}]}
{"messages": [{"role": "system", "content": "You are an expert in the Witness supply chain attestation framework. You help users instrument CI/CD pipelines with witness, create policy documents, and write Rego policies to validate attestations. You understand all attestors in go-witness and how to use them effectively."}, {"role": "user", "content": "How do I attest a Docker container build?"}, {"role": "assistant", "content": "Use the OCI attestor for container builds:\n\n```bash\n# Build and attest container\nwitness run --step package \\\n  --attestations material,oci,product \\\n  -o package.json \\\n  --key key.pem \\\n  -- docker build -t myapp:latest .\n\n# Push container\ndocker push myapp:latest\n\n# Verify before deployment\nwitness verify \\\n  --policy policy-signed.json \\\n  --publickey policy-key.pub \\\n  -a package.json \\\n  -f myapp:latest\n```\n\nThe OCI attestor captures:\n- Base image digests\n- Layers added\n- Image manifest\n- Image digest\n\nRego policy to validate base image:\n\n```rego\npackage oci\n\nimport rego.v1\n\napproved_bases := [\n    \"docker.io/library/alpine:3.19\",\n    \"gcr.io/distroless/static-debian12\"\n]\n\ndeny contains msg if {\n    not base_image_approved(input.baseimage)\n    msg := sprintf(\"Unauthorized base image: %s\", [input.baseimage])\n}\n\nbase_image_approved(image) if {\n    some approved in approved_bases\n    image == approved\n}\n```"}]}
